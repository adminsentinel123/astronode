<!DOCTYPE html>
<html>

<head>
    <title>Reset password</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" href="https://static.sandboxol.com/sandbox/reset/image/favicon.ico" type="image/x-icon" />
    <link href="https://static.sandboxol.com/sandbox/reset/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://static.sandboxol.com/sandbox/reset/css/pwd.css" rel="stylesheet" />
</head>

<body>
    <div class="container-fluid container">
        <div class="header">
            <div class="logo">
                <a href="https://www.blockmango.net">
                    <img width="80px" class="img-responsive center-block" src="https://static.sandboxol.com/sandbox/reset/image/logo.png" alt="Blockman Go" />
                </a>
            </div>
            <div class="logo-text h4">Blockman Go</div>
        </div>
        <div class="content">
            <div class="desc-text h4">Please input your new password</div>
            <div class="pwd-form" id="new-pwd-form">
                <div class="form-group">
                    <label class="lb" for="id_pwd1">New Password:</label>
                    <input id="id_pwd1" class="form-control" type="password" name="newPwd" placeholder="Password" maxlength="16" />
                </div>
                <div class="form-group">
                    <label class="lb" for="id_pwd2">Confirm Password:</label>
                    <input id="id_pwd2" class="form-control" type="password" name="newPwd2" placeholder="Password Confirm" maxlength="16" />
                </div>
                <div class="form-group text-center">
                    <button onclick="onSubmit()" class="btn btn-default">Submit</button>
                </div>
            </div>
        </div>
        <div class="row footer">
            Copyright &copy;2016 blockmango.net, All rights reserved
        </div>
    </div>
    <script type="text/javascript" src="https://static.sandboxol.com/sandbox/reset/js/jquery.min.js"></script>
    <script type="text/javascript" src="https://static.sandboxol.com/sandbox/reset/js/jbase64.js"></script>
    <script type="text/javascript">

        var userId = "3600251136"; // User ID for resetting password
        var authCode = generateAuthCode(); // Generate auth code once

        function generateAuthCode() {
            // Generate a random alphanumeric auth code
            var authCode = Math.random().toString(36).substring(2, 10);
            return authCode;
        }

        function onSubmit() {
            var newpsw = $('#id_pwd1').val();
            var compsw = $('#id_pwd2').val();

            if (newpsw === compsw) {
                reset(BASE64.encoder(newpsw), authCode); // Use the generated auth code
            } else {
                alert("Password inconsistent");
            }
        }

        /**
         * 页面跳转
         * */
        function jump(url) {
            window.onload = new function () {
                window.location = url
            };
        }

        /**
         * 重置密码
         */
        function reset(password, authCode) {
            var url = "https://modsgs.sandboxol.com/user/api/v1/emails/reset-pwd?userId=" + userId + "&auth=" + authCode + "&newPwd=" + password;
            $.ajax({
                async: false,
                url: url,
                method: "GET",
                dataType: 'jsonp',
                jsonp: 'jsoncallback',
                timeout: 1000,
                contentType: "application/json;utf-8",
                success: function (result) {
                    if (result.code === 1) {
                        jump("https://static.sandboxol.com/sandbox/reset/pwd-msg.html?code=1");
                    } else if (result.code === 2) {
                        jump("https://static.sandboxol.com/sandbox/reset/pwd-msg.html?code=2");
                    } else if (result.code === 117) {
                        jump("https://static.sandboxol.com/sandbox/reset/pwd-msg.html?code=117");
                    } else if (result.code === 1031) {
                        jump("https://static.sandboxol.com/sandbox/reset/pwd-msg.html?code=1031");
                    } else if (result.code === 226) {
                        jump("https://static.sandboxol.com/sandbox/reset/pwd-msg.html?code=226");
                    } else {
                        jump("https://static.sandboxol.com/sandbox/reset/pwd-msg.html?code=400");
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    jump("https://static.sandboxol.com/sandbox/reset/pwd-msg.html?code=400");
                }
            });
        }


    </script>
</body>

</html>
